name: üßπ Auto Close Stale Issues and PRs     # Workflow name that appears in GitHub Actions UI

on:                                    # Defines the triggers that cause this workflow to run.
  schedule:                            # Automates daily checks.
    - cron: '30 5 * * 1-5'             # Runs Monday to Friday at 08:30AM (EAT, UTC+3)
  workflow_dispatch:                   # Allows for manual cleanup in GitHub‚Äôs ‚ÄúActions‚Äù UI.

permissions:
  issues: write                        # Needed to comment, label, and close issues
  pull-requests: write                 # Needed to comment, label, and close PRs

jobs:                                  # Defines all the major automated tasks GitHub will run

  stale:                               # Defines a Stale job
    name: Sweep Issues and PRs         # Gives the job a human-readable name which appears in GitHub‚Äôs ‚ÄúActions‚Äù UI.
    runs-on: ubuntu-latest             # Run this job on the latest Ubuntu Linux virtual machine.
    timeout-minutes: 3                 # Automatically cancel an entire job if it runs longer than set minutes.

    steps:

      # üßπ Step 1: Go through repository, clean up stale issues and PRs.
      - name: Clean up stale issues and PRs
        uses: actions/stale@v9
        with:

          # üïí Timers and inactivity thresholds
          days-before-issue-stale: 42  # Mark the issue as stale after 42 days of no activity.
          days-before-issue-close: 21  # Close the issue 21 days later if still inactive.
          days-before-pr-stale: 28     # Mark PR as stale after 28 days of no activity.
          days-before-pr-close: 14     # Close PR 14 days later if still inactive.

          operations-per-run: '200'        # Safety cap ‚Äî limit operations per run.
          remove-stale-when-updated: true  # Automatically unmark when activity resumes.

          # üè∑Ô∏è Exemptions ‚Äî items that should never be marked stale
          exempt-issue-labels: >
            pinned, security, documentation, bug, feature
          exempt-pr-labels: >
            work-in-progress, bug-fix, security,
          exempt-all-assignees: false       # Assigned items can still go stale
          exempt-assignees: wasulabenjamin  # Specific maintainer exemption
          exempt-milestones: true           # Milestone items are active

          # üí¨ Messages shown when items are marked or closed
          stale-issue-message: >
            üëã This issue has been automatically marked as **stale** due to 42 days of inactivity.
            It will be **closed in 21 days** if no further updates occur.
            Please comment or add a label to keep it open.
          close-issue-message: >
            üßπ Closing this issue due to prolonged inactivity.
            Feel free to reopen it or create a new issue if the problem persists.
          stale-pr-message: >
            üëã This pull request has been marked as **stale** due to 28 days of inactivity.
            It will be **closed in 14 days** if no updates occur.
            Please push a new commit or comment to keep it active.
          close-pr-message: >
            üßπ This pull request has been automatically closed after inactivity.
            If still relevant, reopen it or open a fresh PR.

          # ‚öôÔ∏è Label settings
          stale-issue-label: 'stale'
          stale-pr-label: 'stale'
          delete-branch: false              # Keep branches after stale PRs are closed

          # üß† Behavior tuning for small teams
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          enable-statistics: true           # Log how many items were processed
          only-labels: ''                   # Process all issues/PRs

          # Optional: set if you want to limit to newer issues only entrypoint:
          start-date: ''                    # Process all items regardless of creation date

      # üßæ Step 2: Smart summary
      - name: Stale workflow summary
        if: always()
        run: |
          if [[ "${{ job.status }}" == "success" ]]; then
            echo "‚úÖ Stale workflow completed successfully."
            echo "‚è∞ Runs Monday to Friday at 08:30AM (EAT, UTC+3)"
            echo "üìà Statistics are available in the previous step"
          elif [[ "${{ job.status }}" == "failure" ]]; then
            echo "‚ùå Stale job failed"
          else
            echo "‚ö†Ô∏è Stale job ended with status: ${{ job.status }}"
            exit 1
          fi
